#include <sstream>

#include "OBJParser.hpp"
#include "Mesh.hpp"
#include "Vec3.hpp"
#include "Triangle.hpp"

void OBJParser::ParseMesh(const std::string &filename, Mesh& mesh)
{
    std::ifstream objfile(filename);    
    if(objfile.fail())
    {
        std::cout << "Error, file not found: " << filename << std::endl;
        return;
    }

    std::string id_char;
    std::vector<Vec3> vertices;
    std::vector<Triangle> tris;
    //while(std::getline(objfile, line))
    while((objfile >> id_char))
    {
        std::string temp;
        // get a vertex
        if(id_char == "v")
        {
            float v[3];
            for(int i=0; i<3; i++)
            {
                objfile >> temp;
                v[i] = ::atof(temp.c_str());
            }
            Vec3 vertex(v[0], v[1], v[2]);
            vertices.push_back(vertex);
        }

        // create faces
        if(id_char == "f")
        {
            std::vector<int> tokens;
            std::string token;
            char delimiter = '/';
            while(objfile >> temp)
            {    
                std::istringstream tokenStream(temp);
                while(std::getline(tokenStream, token, delimiter))
                {
                    tokens.push_back(::atoi(token.c_str()));
                }

                Triangle tri(vertices[token[0]], vertices[token[1]], vertices[token[2]]);
                std::cout << "temp " << temp << std::endl;
                std::cout << "tri: " <<tri.v[0] << " " << tri.v[1] << " " << tri.v[2] << std::endl;

                tokens.clear();
            }
        }
    }

    for (auto& it : vertices) 
    {
        std::cout << it << std::endl;
    }

}
